<!DOCTYPE html>
<meta charset="utf-8">
<style>

.chart rect {
  fill: lightblue;
}

.chart text {
  fill: darkgreen;
  font: 10px sans-serif;
  text-anchor: end;
}

</style>
<input id="csv-input" type="text" value="Enter comma-separated-values to chart."></input>
<input id="chart-input" onclick="updateChart(d3.event)" type="button" value="Chart Input"></input>
<br />
<svg class="chart"i tabindex="0"></svg>
<script src="d3.v4.min.js" charset="utf-8"></script>
<script>

var data = [2, 4, 8, 16, 32, 64, 128, 256, 512];

var width = 420,
    barHeight = 20;

var x = d3.scaleLinear()
    .domain([0, d3.max(data)])
    .range([0, width]);

var chart = d3.select(".chart")
    .attr("width", width)
    .attr("height", barHeight * data.length);

var bar = chart.selectAll("g")
    .data(data)
  .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width", x)
    .attr("height", barHeight - 1);

bar.append("text")
    .attr("x", function(d) { return x(d) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d) { return d; });

d3.select('#csv-input').on('keyup', function(){
    if (d3.event.key === 'Enter') {
        updateChart(d3.event);
    }
});

function parseInput () {
    var text = d3.select('#csv-input')._groups[0][0].value; 
    console.log('input as read in:', text);
    if (text !== "Enter comma-separated-values to chart.") {
        return JSON.parse('[' + text + ']');
    }
    return data;
}

/** return bar selection after binding and updating to data */
function updateChart(data, event) {
    data = parseInput();

    var x = d3.scaleLinear()
        .domain([0, d3.max(data)])
        .range([0, width]);

    console.log({width,barHeight,x,chart,bar});
    bar = chart.selectAll("g")
        .data(data);
        
    console.log({width,barHeight,x,chart,bar});
    bar.enter().append('g')
        .attr('transform', function(d, i) {return "translate(0," + i * barHeight + ")"; });
    console.log({width,barHeight,x,chart,bar});

    console.log({width,barHeight,x,chart,bar});
    bar.exit()
      .remove();
    console.log({width,barHeight,x,chart,bar});

    bar.append("rect")
      .attr("width", x)
      .attr("height", barHeight - 1);

    bar.append("text")
      .attr("x", function(d) { return x(d) = 3; })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
      .text(function(d) { return d; });
}

</script>
